---
title: "bayes"
format: html
editor: visual
---

```{r}
library(brms)
library(loo)
```

```{r}
all_data1 %>% filter(location == "Lubbock") %>% 
    filter(retrieval_time_months > 0) -> lub_test_data
```

```{r}
weibull_drc_style <- brm(
  bf(viability_prop ~ d * exp(-exp(b * (log(retrieval_time_months) - e))),
     b + d + e ~ 1,
     nl = TRUE),
  data = lub_test_data,
  family = weibull(link = "log", link_shape = "log"),
  prior = c(
    prior(normal(1, 0.5), class = "b", nlpar = "b"),
    prior(normal(0.8, 0.2), class = "b", nlpar = "d"),
    prior(normal(3, 1), class = "b", nlpar = "e")
  ),
  chains = 2,
  iter = 2000,
  backend = "cmdstanr",
  control = list(adapt_delta = 0.95)
) -> weibull_drc_style
```



```{r}
new_data <- tibble(retrieval_time_months = seq(0.01, 60, length.out = 100))

weibull_drc_style %>%
  add_fitted_draws(newdata = new_data, n = 100) %>%
  mutate(.value = log(.value)) %>%
  ggplot(aes(x = retrieval_time_months, y = .value)) +
  geom_jitter(data = lub_test_data, aes(y = viability_prop), color = "black", alpha = 0.6) +
  stat_summary(fun = mean, geom = "line", color = "blue") +
  stat_summary(fun.data = mean_cl_normal, geom = "ribbon", alpha = 0.2)
```

```{r}
AIC(weibull_simple_model_2, weibull_drc_style)
```




```{r}
weibull_simple_model_2 <- brm(
  bf(viability_prop ~ exp(-(retrieval_time_months / lambda)^1.3),
     lambda ~ 1,
     nl = TRUE),
  data = lub_test_data,
  family = weibull(link = "log", link_shape = "log"),
  prior = prior(normal(10, 5), class = "b", nlpar = "lambda"),
  chains = 2,
  iter = 2000,
  backend = "cmdstanr"
)
```




```{r}
weibull_simple_model_2 %>%
  add_fitted_draws(newdata = new_data, n = 100) %>%
  mutate(.value = log(.value)) %>%
  ggplot(aes(x = retrieval_time_months, y = .value)) +
  geom_jitter(data = lub_test_data, aes(y = viability_prop), color = "black", alpha = 0.6) +
  stat_summary(fun = mean, geom = "line", color = "blue") +
  stat_summary(fun.data = mean_cl_normal, geom = "ribbon", alpha = 0.2)
```
































