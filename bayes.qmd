---
title: "bayes"
format: html
editor: visual
---

```{r}
library(brms)
library(loo)
```


```{r}
all_data %>% 
  mutate(viability_prop= viable_seed_as_percent_of_original / 100) %>% 
  mutate(viability_prop = case_when(
    viability_prop == 1 ~ 0.999,
    viability_prop == 0 ~ 0.001,
    TRUE ~ viability_prop
  )) %>% 
  mutate(field_rep = as_factor(field_rep)) -> all_data1
```


```{r}
brm(
  viability_prop ~ retrieval_time_months * species * depth_cm * run +
    (1 | location/field_rep),
  data = all_data1,
  family = Beta(),
  chains = 4,
  iter = 4000,
  save_pars = save_pars(all = TRUE),
  control = list(adapt_delta = 0.95)
) -> full_model

```


```{r}
# Simpler model (no 4-way interaction)
brm(
  viability_prop ~ retrieval_time_months + species + depth_cm + run +
    (1 | location/field_rep),
  data = all_data1,
  family = Beta(),
  chains = 4,
  iter = 4000,
  save_pars = save_pars(all = TRUE),
  control = list(adapt_delta = 0.95)
) -> simple_model
```

```{r}
# Compare using Leave-One-Out Cross-Validation
loo_full <- loo(full_model)
loo_simple <- loo(simple_model)

loo_compare(loo_full, loo_simple)

```

```{r}
# Simpler model (no 4-way interaction)
brm(
  viability_prop ~ retrieval_time_months + species + depth_cm +
    (1 | location/field_rep),
  data = all_data1,
  family = Beta(),
  chains = 4,
  iter = 4000,
  save_pars = save_pars(all = TRUE),
  control = list(adapt_delta = 0.95)
) -> red_model1
```

```{r}
# Compare using Leave-One-Out Cross-Validation
loo_red1 <- loo(red_model1)


loo_compare(loo_simple, loo_red1)

```



```{r}
# Simpler model (no 4-way interaction)
brm(
  viability_prop ~ retrieval_time_months + species + 
    (1 | location/field_rep),
  data = all_data1,
  family = Beta(),
  chains = 4,
  iter = 4000,
  save_pars = save_pars(all = TRUE),
  control = list(adapt_delta = 0.95)
) -> red_model2
```

```{r}
# Compare using Leave-One-Out Cross-Validation
loo_red2 <- loo(red_model2)


loo_compare(loo_red1, loo_red2)

```



```{r}
# Simpler model (no 4-way interaction)
brm(
  viability_prop ~ retrieval_time_months + 
    (1 | location/field_rep),
  data = all_data1,
  family = Beta(),
  chains = 4,
  iter = 4000,
  save_pars = save_pars(all = TRUE),
  control = list(adapt_delta = 0.95)
) -> red_model3
```


```{r}
# Compare using Leave-One-Out Cross-Validation
loo_red3 <- loo(red_model3)


loo_compare(loo_red2, loo_red3)

```
















